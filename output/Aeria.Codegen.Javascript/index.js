// Generated by purs version 0.15.13
import * as Aeria_Codegen_Javascript_Tree from "../Aeria.Codegen.Javascript.Tree/index.js";
import * as Aeria_Codegen_Type from "../Aeria.Codegen.Type/index.js";
import * as Aeria_Codegen_Typescript_Tree from "../Aeria.Codegen.Typescript.Tree/index.js";
import * as Aeria_Syntax_Tree from "../Aeria.Syntax.Tree/index.js";
import * as Control_Lazy from "../Control.Lazy/index.js";
import * as Data_Array from "../Data.Array/index.js";
import * as Data_CodePoint_Unicode from "../Data.CodePoint.Unicode/index.js";
import * as Data_Foldable from "../Data.Foldable/index.js";
import * as Data_Functor from "../Data.Functor/index.js";
import * as Data_HeytingAlgebra from "../Data.HeytingAlgebra/index.js";
import * as Data_Int from "../Data.Int/index.js";
import * as Data_List from "../Data.List/index.js";
import * as Data_List_Types from "../Data.List.Types/index.js";
import * as Data_Maybe from "../Data.Maybe/index.js";
import * as Data_String_CodePoints from "../Data.String.CodePoints/index.js";
var fromFoldable = /* #__PURE__ */ Data_List.fromFoldable(Data_Foldable.foldableArray);
var map = /* #__PURE__ */ Data_Functor.map(Data_List_Types.functorList);
var find = /* #__PURE__ */ Data_Foldable.find(Data_List_Types.foldableList);
var union = /* #__PURE__ */ Data_List.union(Aeria_Codegen_Javascript_Tree.eqJsObjectProperty);
var all = /* #__PURE__ */ Data_Foldable.all(Data_List_Types.foldableList)(Data_HeytingAlgebra.heytingAlgebraBoolean);
var union1 = /* #__PURE__ */ Data_Array.union(Aeria_Codegen_Javascript_Tree.eqJsObjectProperty);
var Codegen = /* #__PURE__ */ (function () {
    function Codegen(value0, value1, value2) {
        this.value0 = value0;
        this.value1 = value1;
        this.value2 = value2;
    };
    Codegen.create = function (value0) {
        return function (value1) {
            return function (value2) {
                return new Codegen(value0, value1, value2);
            };
        };
    };
    return Codegen;
})();
var ucfirst = function (str) {
    if (str === "") {
        return "";
    };
    var v = Data_String_CodePoints.uncons(str);
    if (v instanceof Data_Maybe.Just) {
        return Data_String_CodePoints.fromCodePointArray(Data_CodePoint_Unicode.toUpper(v.value0.head)) + v.value0.tail;
    };
    if (v instanceof Data_Maybe.Nothing) {
        return "";
    };
    throw new Error("Failed pattern match at Aeria.Codegen.Javascript (line 28, column 5 - line 30, column 20): " + [ v.constructor.name ]);
};
var makeObjectProperty = function (ident) {
    return function (tree) {
        return new Aeria_Codegen_Javascript_Tree.JsObjectProperty(new Aeria_Codegen_Javascript_Tree.JsIdentifier(ident), tree);
    };
};
var codegenUnaryExpr = function (oper) {
    return function (e1) {
        return new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSObject(fromFoldable([ makeObjectProperty("operator")(new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSString(oper))), makeObjectProperty("term1")(e1) ])));
    };
};
var codegenTable = function (table) {
    return new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSArray(map(function (v) {
        return new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSString(v.value0));
    })(table)));
};
var codegenLiteral = /* #__PURE__ */ Control_Lazy.fix(Control_Lazy.lazyFn)(function (self) {
    return function (v) {
        if (v instanceof Aeria_Syntax_Tree.LInteger) {
            return new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSNumber(Data_Int.toNumber(v.value0)));
        };
        if (v instanceof Aeria_Syntax_Tree.LFloat) {
            return new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSNumber(v.value0));
        };
        if (v instanceof Aeria_Syntax_Tree.LString) {
            return new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSString(v.value0));
        };
        if (v instanceof Aeria_Syntax_Tree.LBoolean) {
            return new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSBoolean(v.value0));
        };
        if (v instanceof Aeria_Syntax_Tree.LArray) {
            return new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSArray(map(self)(v.value0)));
        };
        if (v instanceof Aeria_Syntax_Tree.LProperty) {
            return new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSString(v.value0.value0));
        };
        throw new Error("Failed pattern match at Aeria.Codegen.Javascript (line 266, column 16 - line 272, column 81): " + [ v.constructor.name ]);
    };
});
var codegenGetters = function (getters) {
    var go = function (v) {
        return makeObjectProperty(v.value0.name.value0)(new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSObject(fromFoldable([ makeObjectProperty("getter")(new Aeria_Codegen_Javascript_Tree.JSArrowFunctionExpression(fromFoldable([ new Aeria_Codegen_Javascript_Tree.JsIdentifier("doc") ]), new Aeria_Codegen_Javascript_Tree.JSCode(v.value0.macro.value1))) ]))));
    };
    return map(go)(getters);
};
var codegenBinaryExpr = function (oper) {
    return function (e1) {
        return function (e2) {
            return new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSObject(fromFoldable([ makeObjectProperty("operator")(new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSString(oper))), makeObjectProperty("term1")(e1), makeObjectProperty("term2")(e2) ])));
        };
    };
};
var codegenExpr = function (v) {
    if (v instanceof Aeria_Syntax_Tree.ELiteral) {
        return codegenLiteral(v.value0);
    };
    if (v instanceof Aeria_Syntax_Tree.EExists) {
        return codegenUnaryExpr("exists")(codegenExpr(v.value0));
    };
    if (v instanceof Aeria_Syntax_Tree.ENot) {
        return codegenUnaryExpr("not")(codegenExpr(v.value0));
    };
    if (v instanceof Aeria_Syntax_Tree.EOr) {
        return new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSObject(fromFoldable([ makeObjectProperty("or")(new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSArray(new Data_List_Types.Cons(codegenExpr(v.value0), new Data_List_Types.Cons(codegenExpr(v.value1), Data_List_Types.Nil.value))))) ])));
    };
    if (v instanceof Aeria_Syntax_Tree.EAnd) {
        return new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSObject(fromFoldable([ makeObjectProperty("and")(new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSArray(new Data_List_Types.Cons(codegenExpr(v.value0), new Data_List_Types.Cons(codegenExpr(v.value1), Data_List_Types.Nil.value))))) ])));
    };
    if (v instanceof Aeria_Syntax_Tree.EIn) {
        return codegenBinaryExpr("in")(codegenExpr(v.value0))(codegenExpr(v.value1));
    };
    if (v instanceof Aeria_Syntax_Tree.ELt) {
        return codegenBinaryExpr("lt")(codegenExpr(v.value0))(codegenExpr(v.value1));
    };
    if (v instanceof Aeria_Syntax_Tree.EGt) {
        return codegenBinaryExpr("gt")(codegenExpr(v.value0))(codegenExpr(v.value1));
    };
    if (v instanceof Aeria_Syntax_Tree.ELte) {
        return codegenBinaryExpr("lte")(codegenExpr(v.value0))(codegenExpr(v.value1));
    };
    if (v instanceof Aeria_Syntax_Tree.EGte) {
        return codegenBinaryExpr("gte")(codegenExpr(v.value0))(codegenExpr(v.value1));
    };
    if (v instanceof Aeria_Syntax_Tree.EEq) {
        return codegenBinaryExpr("eq")(codegenExpr(v.value0))(codegenExpr(v.value1));
    };
    throw new Error("Failed pattern match at Aeria.Codegen.Javascript (line 190, column 1 - line 190, column 30): " + [ v.constructor.name ]);
};
var codegenProperties = function (properties) {
    return function (getters) {
        var getters$prime = codegenGetters(getters);
        var codegenAttributes = map(function (v) {
            if (v.value1 instanceof Aeria_Syntax_Tree.ALiteral) {
                return makeObjectProperty(v.value0.value0)(codegenLiteral(v.value1.value0));
            };
            if (v.value1 instanceof Aeria_Syntax_Tree.AExpr) {
                return makeObjectProperty(v.value0.value0)(codegenExpr(v.value1.value0));
            };
            throw new Error("Failed pattern match at Aeria.Codegen.Javascript (line 227, column 9 - line 229, column 76): " + [ v.value1.constructor.name ]);
        });
        var go = function (v) {
            var attributes$prime = codegenAttributes(v.value0.attributes);
            if (v.value0.type_ instanceof Aeria_Syntax_Tree.PEnum) {
                var options = find(function (v1) {
                    return v1.value0.value0 === "options";
                })(v.value0.attributes);
                if (options instanceof Data_Maybe.Just && (options.value0.value1 instanceof Aeria_Syntax_Tree.ALiteral && options.value0.value1.value0 instanceof Aeria_Syntax_Tree.LArray)) {
                    return fromFoldable([ makeObjectProperty("enum")(new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSArray(map(codegenLiteral)(options.value0.value1.value0.value0)))) ]);
                };
                return fromFoldable([ makeObjectProperty("enum")(new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSArray(Data_List_Types.Nil.value))) ]);
            };
            if (v.value0.type_ instanceof Aeria_Syntax_Tree.PFloat) {
                return union(fromFoldable([ makeObjectProperty("type")(new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSString("number"))) ]))(attributes$prime);
            };
            if (v.value0.type_ instanceof Aeria_Syntax_Tree.PInteger) {
                return union(fromFoldable([ makeObjectProperty("type")(new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSString("integer"))) ]))(attributes$prime);
            };
            if (v.value0.type_ instanceof Aeria_Syntax_Tree.PString) {
                return union(fromFoldable([ makeObjectProperty("type")(new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSString("string"))) ]))(attributes$prime);
            };
            if (v.value0.type_ instanceof Aeria_Syntax_Tree.PBoolean) {
                return union(fromFoldable([ makeObjectProperty("type")(new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSString("boolean"))) ]))(attributes$prime);
            };
            if (v.value0.type_ instanceof Aeria_Syntax_Tree.PArray) {
                return fromFoldable([ makeObjectProperty("type")(new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSString("array"))), makeObjectProperty("items")(new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSObject(union(go(new Aeria_Syntax_Tree.Property({
                    name: v.value0.name,
                    type_: v.value0.type_.value0,
                    attributes: v.value0.attributes
                })))(attributes$prime)))) ]);
            };
            if (v.value0.type_ instanceof Aeria_Syntax_Tree.PObject) {
                return union(fromFoldable([ makeObjectProperty("type")(new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSString("object"))), makeObjectProperty("properties")(codegenProperties(v.value0.type_.value0)(Data_List_Types.Nil.value)) ]))(attributes$prime);
            };
            if (v.value0.type_ instanceof Aeria_Syntax_Tree.PRef) {
                return union(fromFoldable([ makeObjectProperty("$ref")(new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSString(v.value0.type_.value0.value0))) ]))(attributes$prime);
            };
            throw new Error("Failed pattern match at Aeria.Codegen.Javascript (line 237, column 7 - line 262, column 34): " + [ v.value0.type_.constructor.name ]);
        };
        var codegenProperty = function (v) {
            return makeObjectProperty(v.value0.name.value0)(new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSObject(go(v))));
        };
        var properties$prime = map(codegenProperty)(properties);
        return new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSObject(union(properties$prime)(getters$prime)));
    };
};
var codegenRequired = function (required) {
    var hasCondition = all(function (v) {
        return Data_Maybe.isNothing(v.value1);
    })(required);
    var codegenObject = function (v) {
        if (v instanceof Data_Maybe.Nothing) {
            return new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSBoolean(true));
        };
        if (v instanceof Data_Maybe.Just) {
            return codegenExpr(v.value0);
        };
        throw new Error("Failed pattern match at Aeria.Codegen.Javascript (line 169, column 3 - line 169, column 53): " + [ v.constructor.name ]);
    };
    if (hasCondition) {
        return new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSArray(map(function (v) {
            return new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSString(v.value0.value0));
        })(required)));
    };
    return new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSObject(map(function (v) {
        return makeObjectProperty(v.value0.value0)(codegenObject(v.value1));
    })(required)));
};
var codegenCollection = function (v) {
    var codegenDescription = (function () {
        var tableDescription = (function () {
            if (v.value0.table instanceof Data_List_Types.Nil) {
                return [  ];
            };
            return [ makeObjectProperty("table")(codegenTable(v.value0.table)) ];
        })();
        var requiredDescription = (function () {
            if (v.value0.required instanceof Data_List_Types.Nil) {
                return [  ];
            };
            return [ makeObjectProperty("required")(codegenRequired(v.value0.required)) ];
        })();
        var baseDescription = [ makeObjectProperty("$id")(new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSString(v.value0.name.value0))), makeObjectProperty("properties")(codegenProperties(v.value0.properties)(v.value0.getters)) ];
        var description = union1(union1(baseDescription)(tableDescription))(requiredDescription);
        return new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSObject(fromFoldable(description)));
    })();
    return new Aeria_Codegen_Javascript_Tree.JSLiteral(new Aeria_Codegen_Javascript_Tree.JSObject(fromFoldable([ makeObjectProperty("description")(codegenDescription) ])));
};
var codegen = function (v) {
    var go = function (v1) {
        var collection$prime = codegenCollection(v1);
        var jsFile = new Aeria_Codegen_Javascript_Tree.JsStatements(fromFoldable([ new Aeria_Codegen_Javascript_Tree.JSImportDeclaration(new Aeria_Codegen_Javascript_Tree.JsSpecifiers(fromFoldable([ new Aeria_Codegen_Javascript_Tree.JsImportSpecifier(new Aeria_Codegen_Javascript_Tree.JsIdentifier("defineCollection")), new Aeria_Codegen_Javascript_Tree.JsImportSpecifier(new Aeria_Codegen_Javascript_Tree.JsIdentifier("deepMerge")) ])), new Aeria_Codegen_Javascript_Tree.JsIdentifier("sonata-api")), new Aeria_Codegen_Javascript_Tree.JSExportNamedDeclaration(new Aeria_Codegen_Javascript_Tree.JSVariableDeclaration(new Aeria_Codegen_Javascript_Tree.JsIdentifier(v1.value0.name.value0), collection$prime)), new Aeria_Codegen_Javascript_Tree.JSExportNamedDeclaration(new Aeria_Codegen_Javascript_Tree.JSVariableDeclaration(new Aeria_Codegen_Javascript_Tree.JsIdentifier("extendCollection"), new Aeria_Codegen_Javascript_Tree.JSArrowFunctionExpression(fromFoldable([ new Aeria_Codegen_Javascript_Tree.JsIdentifier("collection") ]), new Aeria_Codegen_Javascript_Tree.JSCallExpression(new Aeria_Codegen_Javascript_Tree.JsIdentifier("defineCollection"), fromFoldable([ new Aeria_Codegen_Javascript_Tree.JSCallExpression(new Aeria_Codegen_Javascript_Tree.JsIdentifier("deepMerge"), fromFoldable([ new Aeria_Codegen_Javascript_Tree.JSIdentifier(new Aeria_Codegen_Javascript_Tree.JsIdentifier(v1.value0.name.value0)), new Aeria_Codegen_Javascript_Tree.JSIdentifier(new Aeria_Codegen_Javascript_Tree.JsIdentifier("collection")) ])) ]))))) ]));
        var tsFile = new Aeria_Codegen_Typescript_Tree.TsStatements(fromFoldable([ new Aeria_Codegen_Typescript_Tree.TSImportDeclaration(new Aeria_Codegen_Typescript_Tree.TsSpecifiers(fromFoldable([ new Aeria_Codegen_Typescript_Tree.TsImportSpecifier(new Aeria_Codegen_Typescript_Tree.TsIdentifier("Collection")), new Aeria_Codegen_Typescript_Tree.TsImportSpecifier(new Aeria_Codegen_Typescript_Tree.TsIdentifier("SchemaWithId")) ])), new Aeria_Codegen_Typescript_Tree.TsIdentifier("@sonata-api/types")), new Aeria_Codegen_Typescript_Tree.TSExportNamedDeclaration(new Aeria_Codegen_Typescript_Tree.TSVariableStatement(fromFoldable([ Aeria_Codegen_Typescript_Tree.TsDeclareKeyword.value, Aeria_Codegen_Typescript_Tree.TsConstKeyword.value ]), new Aeria_Codegen_Typescript_Tree.TsIdentifier(v1.value0.name.value0), Aeria_Codegen_Type.codegenType(collection$prime))), new Aeria_Codegen_Typescript_Tree.TSExportNamedDeclaration(new Aeria_Codegen_Typescript_Tree.TSTypeAliasDeclaration(new Aeria_Codegen_Typescript_Tree.TsIdentifier(ucfirst(v1.value0.name.value0)), new Aeria_Codegen_Typescript_Tree.TSTypeReference(fromFoldable([ new Aeria_Codegen_Typescript_Tree.TsTypeParameter(new Aeria_Codegen_Typescript_Tree.TSTypeQuery(new Aeria_Codegen_Typescript_Tree.TsIdentifier(v1.value0.name.value0 + ".description"))) ]), new Aeria_Codegen_Typescript_Tree.TsIdentifier("SchemaWithId")))), new Aeria_Codegen_Typescript_Tree.TSExportNamedDeclaration(new Aeria_Codegen_Typescript_Tree.TSTypeAliasDeclaration(new Aeria_Codegen_Typescript_Tree.TsIdentifier("extendCollection"), new Aeria_Codegen_Typescript_Tree.TSFunctionType(fromFoldable([ new Aeria_Codegen_Typescript_Tree.TsTypeParameter(new Aeria_Codegen_Typescript_Tree.TSTypeExtends(new Aeria_Codegen_Typescript_Tree.TSTypeReference(Data_List_Types.Nil.value, new Aeria_Codegen_Typescript_Tree.TsIdentifier("T")), new Aeria_Codegen_Typescript_Tree.TSTypeReference(Data_List_Types.Nil.value, new Aeria_Codegen_Typescript_Tree.TsIdentifier("Collection")))) ]), fromFoldable([ new Aeria_Codegen_Typescript_Tree.TsParameter(new Aeria_Codegen_Typescript_Tree.TsIdentifier("collection"), new Aeria_Codegen_Typescript_Tree.TSTypeReference(Data_List_Types.Nil.value, new Aeria_Codegen_Typescript_Tree.TsIdentifier("T"))) ]), new Aeria_Codegen_Typescript_Tree.TSIntersectionType(new Aeria_Codegen_Typescript_Tree.TSTypeReference(Data_List_Types.Nil.value, new Aeria_Codegen_Typescript_Tree.TsIdentifier("T")), new Aeria_Codegen_Typescript_Tree.TSTypeQuery(new Aeria_Codegen_Typescript_Tree.TsIdentifier(v1.value0.name.value0)))))) ]));
        return new Codegen(v1.value0.name.value0, jsFile, tsFile);
    };
    return map(go)(v.value0.collections);
};
export {
    Codegen,
    codegen
};
